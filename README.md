# Amazon Review Analyzer

Amazon Review Analyzer (ARA) is a Python tool to scrape, process, and analyze product reviews on Amazon.com to generate common topics your customers are talking about. It scrapes every review, stores them in a lightweight database, and applies an LDA topic model to generate topic keywords.

### Implementation Overview

1. Flask API: ARA runs a lightweight Flask server with two REST API endpoints: `scrape` which scrapes reviews and inserts them to a record in `tinydb` and `process` which runs Gensim's LDA topic modelling on those reviews to generate topics.
2. Chrome Extension: Adds an "Analyze" button to any product page on Amazon.com, and renders the topics in a table on the product page if they exist.

#### Database Model for Product Records

ARA uses a lightweight local Python database implementation `TinyDB` to store and retrieve reviews and topics. When a product is requested for analysis through the `scrape` endpoint, a record in the database is generated with the following fields:

    record = {
        'asin': string - unique identifier of the product on Amazon.com,
        'reviews': array - raw review text, one element per review,
        'status': string - status of the scrape or process job,
        'topics': array - raw topics generated by Gensim LDA with probabilities per word,
        'pretty_topics': 2D array - one array per topic, with each topic word in the sub-array (no probabilities),
        'product_title': string - the title of the product on Amazoin.com
    }

### API Documentation
The Flask API handles two things: scraping and LDA processing. Two Flask "routes" are defined, `/scrape` and `/process` - both are POST requests.

#### Scraper
The scraper endpoint takes an ASIN as a request parameter (required). Every product on Amazon has a unique ASIN, and they can be found in every product page URL or in the product detail information.

For example, the ASIN in `https://www.amazon.com/XLUX-Soil-Moisture-Sensor-Meter/dp/B014MJ8J2U/` is `B014MJ8J2U`.

The `/scrape` route will check the TinyDB database to see if there are any existing records matching the provided ASIN.
1. If there is a matching record with reviews and topics already generated, the database record is returned as JSON. (see example record above)
2. If there is a matching record with reviews, but there are no topics, a new thread is launched that invokes the LDA processor: `lda_processor.generate_text_data_from_record, args=(reviews,payload["asin"],record['product_title'],)`
3. If there is no existing record for the provided ASIN, a new thread is launched that invokes the scraper: `scraper.get_reviews_by_asin(ASIN)`

If a request is made with the optional parameter `force`, the entire record will be re-built by running the scrape job again. Because new reviews are constantly being added by customers, this enables you to retrieve those new reviews on a regular cadence.

#### Scraper Endpoint Example Requests
POST http://localhost:5000/scrape

    {
        "asin": "B08SC42G8B"
    }
    
To force a re-run of an existing ASIN, include the optional parameter "force" to request body.

    {
        "asin": "B08SC42G8B",
        "force": true
    }
    
#### LDA Processor 

#### LDA Processor Endpoint Example Requests
POST http://localhost:5000/process

    {
        "asin": "B08SC42G8B"
    }

### How to Install

1. This deployment requires Python 3.10+. I'd recommend using Conda (Anaconda / Miniconda) to save yourself frustration when managing multiple Python versions and libraries. You can quickly install Miniconda with their installers for MacOS and Windows: https://docs.conda.io/en/latest/miniconda.html (hint: use .pkg on MacOS for faster install).
2. Clone this repository to your machine.

#### Python Project
    conda create --name env-name python=3.10
    conda activate env-name
    pip install .
    
#### Extension
1. From Google Chrome, chrome://extensions/
2. Click "Load unpacked"
3. Select the extension folder

### How to Run
From the app folder, run the following command to start Flask on localhost:5000

Option 1:
    ./run.sh
    
Option 2:
    FLASK_APP=app.py FLASK_ENV=development flask run

